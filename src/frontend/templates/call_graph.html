<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/themes/default/style.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="../src/frontend/templates/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/jstree.min.js"></script>
    <title>Call Graph for {{ root_name }}</title>
</head>
<body>
    <nav class="navbar has-background-link" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="../index.html">
                <h1 class="title is-4 has-text-white">Static Binary Analysis Report</h1>
            </a>
        </div>
    </nav>
    <div class="buttons is-centered">
        <a href="../root_functions.html" class="button is-link is-light">
            <span class="icon is-small"><i class="fas fa-table"></i></span>
            <span>Back to Root functions List</span>
        </a>
        <a href="../index.html" class="button is-link is-light">
            <span class="icon is-small"><i class="fas fa-home"></i></span>
            <span>Back to Homepage</span>
        </a>
    </div>

    <div id="jstree"></div>

    <!-- Passing JSON data via a hidden div with data-tree attribute -->
    <div id="tree-data" data-tree="{{ js_tree }}" style="display:none;"></div>

    <!-- Footer -->
    <footer class="footer">
        <div class="content has-text-centered">
            <p>
                <strong>Static Binary Analysis Report</strong> by Giuseppe Marco Bianco. The source code is licensed under <a href="https://github.com/SoftengPoliTo/manifest-producer/blob/main/LICENSE/MIT.txt">MIT</a>.
            </p>
        </div>
    </footer>

    <script>
        $(document).ready(function() {
            const treeDataElement = document.getElementById("tree-data");
            const tree = treeDataElement.getAttribute("data-tree");
            var treeData = JSON.parse(tree);

            $('#jstree').jstree({
                'core': {
                    'data': treeData
                },
                "types": {
                    "default": {
                        "icon": "fas fa-folder"
                    },
                    "root": {
                        "icon": "fas fa-tree"
                    },
                    "leaf": {
                        "icon": "fas fa-leaf"
                    }
                },
                "plugins": ["types"]
            }).on("loaded.jstree", function(e, data) {
                var rootNode = data.instance.get_node(data.instance.get_node("#").children[0]);
                data.instance.set_type(rootNode, "root");

                data.instance.get_json('#', { 'flat': true }).forEach(function(node) {
                    if (data.instance.is_leaf(node)) {
                        data.instance.set_type(node.id, "leaf");
                    }
                });
            });

            $('#jstree').on("select_node.jstree", function(e, data) {
                alert("Hai selezionato: " + data.node.text);
            });
        });
    </script>
</body>
</html>
